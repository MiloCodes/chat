<!doctype html>
<html>

<head>
  <title>Chat</title>
  <link rel="icon" type="image/png" href="mobius2.png" />
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div id="count">0</div>
  <div id="messageContainer">
    <div id="messages"></div>
  </div>

  <form action="">
    <input id="m" autocomplete="off" placeholder="Message" autofocus />
    <button>Send</button>
  </form>


  <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
  <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
  <script>
    $(() => {
      function getRandomColor() {
        const letters = '0123456789ABCDEF';
        let color = '#';
        for (let i = 0; i < 6; i += 1) {
          color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
      }
      // eslint-disable-next-line no-undef
      const socket = io();
      const yourColor = getRandomColor();

      $('#m').css('color', yourColor);
      $('#count').css('color', yourColor);
      $('form').css('border-top', `1px solid ${yourColor}`);
      $('button').css('background-color', yourColor);

      $('form').submit(() => {
        if ($('#m').val()) {
          socket.emit('chat message', $('#m').val(), yourColor);
          $('#m').val('');
        }
        return false;
      });
      socket.on('chat message', (msg, color) => {
        $('#messages').append($('<div>').html(msg).css('color', color));
        window.scrollTo(0, document.body.scrollHeight);
      });
      socket.on('user count', (count) => {
        $('#count').html(count);
        window.document.title = `Chat: ${count} users`;
      });
      socket.on('refresh', () => {
        // eslint-disable-next-line no-restricted-globals
        location.reload();
      });
    });
  </script>
</body>

</html>